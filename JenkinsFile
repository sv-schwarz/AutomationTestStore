pipeline{
    agent any

    tools {nodejs "NodeJS"}
    
        stages {
            stage('Install dependencies') { 
                steps {
                    sh 'npm ci' 
                }
            }
            stage('Cypress run') { 
                steps {
                    catchError
                    sh 'allure:clearData'
                    sh 'cy:testWithAllureReport'
                }
            }
            stage('Generate Allure Report') { 
                steps {
                    sh 'allure:generateReport'
                    allure{
                        results: [[allure-results]]
                    } 
                }
            }
    }
}